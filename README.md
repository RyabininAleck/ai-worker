# Работа над задачами с ИИ

Наш проект уже отлично отрефакторен согласно ПРАВИЛАМ.
Теперь ИИ отлично справляется с созданием несложных фич и не убивает проект.

## Автоматизация работы

Надо бы автоматизировать работу над задачами.
Для этого нам понадобится:
- Cursor IDE или Claude CLI
- MCP Jira
- MCP GitLab

```json
{
  "mcpServers": {
    "atlassian": {
      "command": "npx",
      "args": [
        "-y",
        "mcp-remote@latest",
        "https://mcp.atlassian.com/v1/sse"
      ]
    },
    "gitlab": {
      "transport": "http",
      "url": "https://gitlab.blablabla.io/api/v4/mcp"
    }
  }
}
```

Авторизация Jira работает так: при первом запуске браузер сам не открывается, поэтому нужно вручную открыть логи MCP в Cursor, найти в них OAuth‑ссылку и перейти по ней для авторизации. После перехода по ссылке вас автоматически перебрасывает на вашу корпоративную Jira (например, blablabla.atlassian.net), где в процессе OAuth‑логина можно выбрать нужный workspace.

GitLab ведет себя аналогично, но, в отличие от Jira, обычно «заводится из коробки» с тем же подходом. Он поддерживает и GitLab.com, и self‑hosted инстансы, использует HTTP‑transport вместо запуска через npx, а OAuth‑авторизация также инициируется через ссылку из логов и проходит по схожему сценарию.

## Настройка переменных окружения

Чтобы не указывать номер задачи и путь к проекту в каждом промпте, установите переменные окружения:

### Windows (CMD):
```bash
setx JIRA_TASK_ID "SBX-123"
```


## Этапы работы

1. Формулировка задачи
2. Нахождение возможных решений
3. Выбор решения и декомпозиция на шаги
4. Создание ветки и мерж реквеста
5. Итеративная реализация каждого шага
   - Разработка
   - Написание тестов
   - Тестирование
   - Коммит
6. Описание изменений в MR
7. Обновление документации проекта

### Этап 1: Формулировка задачи

```
Use jira mcp
Изучи задачу $JIRA_TASK_ID
Пиши, сокращай: выброси лишнее, оставь факты, пиши для пользы читателя.

1. Изучи код для задачи $JIRA_TASK_ID
2. Сформулируй на основании кода техническое описание задачи:
   - Цель изменений (обязательно, до 2 строк)
   - Настоящий результат (обязательно, до 2 строк)
   - Желаемый результат (обязательно, до 2 строк)
   - Функциональные требования (не обязательно, списком до 5)
   - Нефункциональные требования (не обязательно, списком до 5)
   - Тестовые кейсы (обязательно, Будь краток и конкретен)

ПОСЛЕ МОЕГО ОДОБРЕНИЯ!
Обогати текст задачи в Jira данными из нового описания задачи.
Никакие существующие факты не должны потеряться при обновлении текста задачи.
```

### Этап 2: Нахождение возможных решений

```
Use jira mcp $JIRA_TASK_ID
Пиши, сокращай: выброси лишнее, оставь факты, пиши для пользы читателя.

На основании описания задачи $JIRA_TASK_ID:
1. Предложи 2 разных технических решения с кодовыми примерами
   (НЕ БОЛЬШЕ 5 строк каждый)
2. При возможности предложи использоваться готовое решение в виде библиотеки.
3. Для каждого решения укажи:
   - Плюсы/минусы
   - Количество затронутых файлов (~3, ~7, ~15)

ПОСЛЕ МОЕГО ОДОБРЕНИЯ
Добавь комментарий к задаче.
Комментарий должен содержать 3 предложенных решения, 2-3 строки для каждого решения.
```

### Этап 3: Декомпозиция

```
Изучи @.cursor/правило.md
Дай подробный поэтапный план выполнения задачи (5-7 шагов)

ПОСЛЕ МОЕГО ОДОБРЕНИЯ! use jira mcp
Добавь комментарий с обоснованием выбранного подхода (до 200 слов)
Добавь комментарий С планом к задаче.
```

### Этап 4: Создание ветки и MR

```
Use jira mcp $JIRA_TASK_ID
Создай ветку:
git checkout -b [feature/bug/refactor]/$JIRA_TASK_ID-[описание 2-3 слова]
Дай сообщение коммита. Коммит и пуш я сделаю самостоятельно

Use gitlab mcp
Создай мерж реквест из новой ветки в main.
Назначь меня создателем MR.
```

### Этап 5: Реализация и тесты

```
Use jira mcp $JIRA_TASK_ID
Получи полный контекст задачи $JIRA_TASK_ID, изучи выбранное решение и тестовые кейсы.

1. Сгенерируй код согласно @.cursor/правило.md
2. Сгенерируй тесты согласно @.cursor/правило.md
3. Запусти тесты функции - убедись что работает правильно
```

### Этап 6: Коммит

```
Сформулируй коммит: $JIRA_TASK_ID короткое название

Описание:
[ссылка на задачу $JIRA_TASK_ID]
коротко что изменено на этом этапе
Название новых тестов
Пиши, сокращай: выброси лишнее, оставь факты, пиши для пользы читателя.

Сделай git commit
Сделай git push
Use gitlab mcp проверь что все тесты в ci/cd в гитлабе прошли
```

После того как задача выполнена:

### Этап 7: AI Code Review

```
Проведи детальный review измененного кода:
1. Проверь соблюдение @.cursor/правило.md проекта
2. Найди потенциальные баги, race conditions, memory leaks
3. Проверь покрытие тестами (должно быть ≥80%)
4. Оцени производительность (нет ли O(n²) где можно O(n), нет ли лишних вызовов и преобразований)
5. Проверь безопасность (OWASP Top 10)
```

### Этап 8: Описание изменений в MR

```
Use gitlab mcp 
Изучи все измененные файлы в diff для MR соовтетствующего этой ветке.

1. Напиши описание мерж реквеста:
   - Причина изменения кода (почему это нужно было сделать)
   - Общее описание что изменено (кратко, структурировано)
   - Ссылка на задачу $JIRA_TASK_ID в Jira

2. Напиши комментарии ко всем измененным файлам в MR diff в начале файла:
   - Краткое (до 6 строк) и неформальное описание причины изменения каждого файла
   - Объясни что именно изменено в файле и зачем
   - Пиши простым языком, без лишних формальностей
```

### Этап 9: Обновление документации проекта

```
Изучи все изменения в коде  микровервиса и найди документацию микросервиса в docs/.

1. Определи какие части документации нужно обновить:
   - API документация (если изменились эндпоинты, параметры, форматы ответов)
   - Архитектурная документация (если изменилась структура, добавлены новые компоненты)
   - Примеры использования (если изменился API или способ использования)

2. Обнови документацию в соответствии с нововведениями:
   - Опиши новые возможности и изменения
   - Обнови примеры кода если они устарели
   - Добавь информацию о новых зависимостях или конфигурациях
   - Обнови инструкции по установке/запуску если они изменились

3. Убедись что документация:
   - Соответствует текущему состоянию кода
   - Содержит актуальные примеры
   - Не содержит устаревшей информации
   - Легко читается и понятна

4. Внеси изменения в документацию
5. Дай мне сообщение для коммита
```

### Дополнительно: Отчет по результатам рабочего дня

```
Ты — мой ежедневный Jira-репортер. Используй MCP Jira.

1. Получи список всех моих задач на активной доске спринта. Выбери задачи, у которых сегодня обновился статус или появились комментарии.
2. Для каждой такой задачи 
   - Получи все комментарии за сегодня:
   - Извлеки суть: что сделано, прогресс, проблемы, следующие шаги.

3. Составь краткую выжимку. Каждая задача в формате:
   - [KEY: Summary](jira_url) _текущий cтатус_ 
     - Сделано сегодня: [2-3 предложения сути].
     
Игнорируй задачи без моих обновлений сегодня. Используй только данные из MCP, не предполагай.
```
